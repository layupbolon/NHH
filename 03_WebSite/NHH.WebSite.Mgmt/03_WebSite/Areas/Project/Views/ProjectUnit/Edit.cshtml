@{Layout = "~/Views/Shared/_Layout.cshtml";}
@model NHH.Models.Project.ProjectUnit.ProjectUnitInfoModel

@{Html.RenderPartial("_PartialCrumbs", Model.CrumbInfo);}
<style>
    .uploadify-queue {
        display: none;
    }
</style>
<div class="page-content">
    <div class="page-content-area">
        <div class="page-header">
            <h1>
                铺位信息
            </h1>
        </div><!-- /.page-header -->

        <div class="row">
            <div class="col-xs-12">
                <!-- PAGE CONTENT BEGINS -->
                <div class="row">
                    <div class="col-xs-12">
                        <div class="row">
                            <div class="col-xs-12">
                                @using (Html.BeginForm("Edit", "ProjectUnit", new { area = "Project" }, FormMethod.Post, new { @class = "form-horizontal", novalidate = "novalidate" }))
                                {
                                    <div class="space-2"></div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label no-padding-right" for="form-field-1"> 楼层： </label>
                                        <div class="col-sm-9">
                                            <span class="defauletext">
                                                @Model.BuildingName @Model.FloorName
                                            </span>
                                        </div>
                                    </div>
                                    <div class="space-2"></div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label no-padding-right" for="form-field-1"> 状态： </label>
                                        <div class="col-sm-9">
                                            <span class="defauletext">
                                                @Model.UnitStatusName
                                            </span>
                                        </div>
                                    </div>
                                    <div class="space-2"></div>
                                    <div class="form-group">
                                        <label class="control-label col-xs-12 col-sm-3 no-padding-right">类型：</label>
                                        <div class="col-xs-12 col-sm-9">
                                            <div class="clearfix">
                                                @Html.DropDownList("UnitTypeId", ViewData["UnitTypeList"] as SelectList)

                                            </div>
                                        </div>
                                    </div>
                                    <div class="space-2"></div>
                                    <div class="form-group">
                                        <label class="control-label col-xs-12 col-sm-3 no-padding-right"><span class="req">*</span>铺位编号：</label>
                                        <div class="col-xs-12 col-sm-9">
                                            <div class="clearfix">
                                                @Html.TextBox("UnitNumber", Model.UnitNumber, new { @class = "col-xs-12 col-sm-4" })
                                                <span class="help-inline col-xs-12 col-sm-7">
                                                    <span class="middle red">
                                                        @Html.ValidationMessage("UnitNumber")
                                                    </span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="space-2"></div>
                                    <div class="form-group">
                                        <label class="control-label col-xs-12 col-sm-3 no-padding-right"><span class="req">*</span>计租面积：</label>
                                        <div class="col-xs-12 col-sm-9">
                                            <div class="clearfix">
                                                @Html.TextBox("UnitArea", Model.UnitArea, new { @class = "col-xs-12 col-sm-4", @placeHolder = "数值应为小数点后两位" })
                                                <span class="help-inline col-xs-12 col-sm-7">
                                                    <span class="middle">平方米</span>
                                                    <span class="middle red">
                                                        @Html.ValidationMessage("UnitArea")
                                                    </span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="space-2"></div>
                                    <div class="form-group">
                                        <label class="control-label col-xs-12 col-sm-3 no-padding-right"><span class="req">*</span>铺位效果图：</label>
                                        <div class="col-xs-12 col-sm-9">
                                            <div class="clearfix">
                                                <a class="btn btn-add btn-font upload-btn">
                                                    <input type="button" id="btnUpload" class="load-text" />
                                                    @Html.Hidden("UnitMapFileName", Model.UnitMapFileName)
                                                </a>
                                                <p class="muted">图片大小不能超过2M，图片类型为jpg、png</p>
                                                <div class="uploadimg">
                                                    <dl>
                                                        <dd><img src="@NHH.Framework.Utility.UrlHelper.GetImageUrl(Model.UnitMapFileName, 100)" id="img1"></dd>
                                                    </dl>
                                                </div>
                                                <span class="middle red">
                                                    @Html.ValidationMessage("FloorMapFileName")
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="space-2"></div>
                                    <div class="form-group">
                                        <label class="control-label col-xs-12 col-sm-3 no-padding-right">平面图位置：</label>
                                        <div class="col-xs-12 col-sm-9">
                                            <a href="###" class="lnkMapFile">
                                                <img id="smallMap" src="@NHH.Framework.Utility.UrlHelper.GetImageUrl(Model.FloorMapFileName, 100)" title="楼层平面图" alt="" width="100" data-src="@NHH.Framework.Utility.UrlHelper.GetImageUrl(Model.FloorMapFileName, 800)" />
                                            </a>
                                            @Html.Hidden("FloorMapLocation", Model.FloorMapLocation)
                                            @Html.Hidden("FloorMapX", Model.FloorMapX)
                                            @Html.Hidden("FloorMapY", Model.FloorMapY)
                                        </div>
                                    </div>
                                    <div class="space-2"></div>
                                    <div class="clearfix form-actions">
                                        <div class="col-md-offset-3 col-md-9">
                                            @Html.Hidden("BuildingId", Model.BuildingId)
                                            @Html.Hidden("FloorId", Model.FloorId)
                                            @Html.Hidden("UnitId", Model.UnitId)
                                            @Html.Hidden("ProjectId", Model.ProjectId)
                                            <input type="submit" id="btnSubmit" class="btn btn-xs btn-success btn-font input-btn" name="btnSubmit" value="提交保存" />
                                            <input type="button" id="btnDel" class="btn btn-xs  btn-purple btn-font input-btn" name="btnDel" value="作废" />
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div><!-- /.span -->
                </div><!-- /.row -->
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.page-content-area -->
</div>
<script type="text/javascript" src="~/Scripts/MapLocation.js"></script>
<link href="~/Scripts/uploadify/uploadify.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="~/Scripts/uploadify/jquery.uploadify.js"></script>
<script type="text/javascript">
    $(function () {
        var formData = {};
        formData.floorId = $("#FloorId").val();
        $("#btnUpload").uploadify({
            "swf": "/Scripts/uploadify/uploadify.swf",
            "uploader": "@NHH.Framework.Utility.UrlHelper.GetImageUrl("ProjectUnit/Upload")",
            "formData": formData,
            "buttonText": "上传图片",
            "fileTypeExts": "*.jpg;*.png",
            "multi": false,
            "onUploadSuccess": function (file, data, response) {
                var result = eval("(" + data + ")");
                if (!result.Result) {
                    alert(result.Message);
                    return false;
                }
                $("#UnitMapFileName").val(result.FilePath);
                $("#img1").attr("src", result.FileUrl);
            },
            "onUploadProgress": function () { }
        });
        //作废
        $("#btnDel").click(function () {
            nhhui.confirm("你确定要作废该铺位吗？", function () {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("Del", "ProjectUnit", new { area = "Project" })",
                    data: { "projectId": $("#ProjectId").val(), "unitId": $("#UnitId").val() },
                    success: function (result, status) {
                        if (!result.IsSuccess) {
                            alert(result.Message);
                            return false;
                        }
                        var url = "@Url.Action("List", "ProjectUnit", new { area = "Project" })";
                        url += "?projectId=" + $("#ProjectId").val();
                        location.href = url;
                    }
                });
            });
        });
    });
    $(function () {
        MapLocation.init("smallMap");        
    });
</script>
